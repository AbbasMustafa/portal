{% extends './sale/base.html' %}
{% block body %}

<style>
	.pace {
    display: none !important;
}
	.order-actions a {
		margin-right: 5px;
	}

	.order-actions {
		z-index: 999;
	}

	#example tr:hover {
		background: rgba(0, 0, 0, 0.4);
		cursor: pointer;
	}

	#a1 {
		color: green;
	}

	#a0 {
		color: red;
	}
</style>

<link href="{{ url_for('static', filename='plugins/datatable/css/dataTables.bootstrap5.min.css')}}" rel="stylesheet" />




<!--end header -->
<!--start page wrapper -->
<div class="page-wrapper">
	<div class="page-content">

		<!--end breadcrumb-->
		<h6 class="mb-0 text-uppercase">Orders</h6>
		<hr />
		<div class="card">
			<div class="card-body">
				<div class="table-responsive">
					<table id="example" class="table table-striped table-bordered" style="width:100%">
						<thead class="table-light">
							<tr>
								<th>Order id</th>
								<th>Order Title</th>
								<th>Sales Agent</th>
								<th>Assigned To</th>
								<th>Amount</th>
								<th>Status</th>
								<th>Action</th>
							</tr>
						</thead>
						<tbody>

<!-- 
							<tr>
								<td>#897656</td>
								<td>
									<div class="project">
										<div class="project-name">Light Blue Chair Light Blue Chair</div>
										<div class="due-date badge rounded-pill bg-warning text-white w-100">2012-12-12:19:00</div>
									</div>
								</td>
								<td>Brooklyn Zeo</td>
								<td>
									<div class="assigned-to">
										<i title="Abbas" class="fa fa-user"></i>
									</div>
								</td>
								<td>$64.00</td>
								<td>
									<div class="badge rounded-pill bg-light text-white w-100">In Progress</div>
								</td>
								<td>
									<div class="d-flex order-actions">	
										<a href="javascript:;" class=""><i class="bx bx-pencil"></i></a>
									</div>
								</td>
							</tr>
							<tr>
								<td>#987549</td>
								<td>
									<div class="project">
										<div class="project-name">Light Blue Chair</div>
										<div class="due-date badge rounded-pill bg-light text-white w-100">2012-12-12:19:00</div>
									</div>
								</td>
								<td>Martin Hughes</td>
								<td>
									<div class="assigned-to">
										<i title="Abbas" class="fa fa-user"></i>
										<i title="Khan" class="fa fa-user"></i>
									</div>
								</td>
								<td>$45.00</td>
								<td>
									<div class="badge rounded-pill bg-light text-white w-100">Completed</div>
								</td>
								<td>
									<div class="d-flex order-actions">	
										<a href="javascript:;" class=""><i class="bx bx-pencil"></i></a>
									</div>
								</td>
							</tr>
							<tr>
								<td>#685749</td>
								<td>
									<div class="project">
										<div class="project-name"><s>Light Blue Chair</s></div>
										<div class="due-date badge rounded-pill bg-warning text-white w-100">2012-12-12:19:00</div>
									</div>
								</td>
								<td>Shoan Stephen</td>
								<td>
									<div class="assigned-to">
										<i title="Abbas" class="fa fa-user"></i>
										<i title="Khan" class="fa fa-user"></i>
									</div>
								</td>
								<td>$67.00</td>
								<td>
									<div class="badge rounded-pill bg-light text-white w-100">Cancelled</div>
								</td>
								<td>
									<div class="d-flex order-actions">	
										<a href="javascript:;" class=""><i class="bx bx-pencil"></i></a>
									</div>
								</td>
							</tr>
							<tr>
								<td>#887459</td>
								<td>
									<div class="project">
										<div class="project-name">Light Blue Chair</div>
										<div class="due-date badge rounded-pill bg-light text-white w-100">2012-12-12:19:00</div>
									</div>
								</td>
								<td>Alister Campel</td>
								<td>
									<div class="assigned-to">
										<i title="Abbas" class="fa fa-user"></i>
										<i title="Khan" class="fa fa-user"></i>
									</div>
								</td>
								<td>$87.00</td>
								<td>
									<div class="badge rounded-pill bg-light text-white w-100">Completed</div>
								</td>
								<td>
									<div class="d-flex order-actions">	
										<a href="javascript:;" class=""><i class="bx bx-pencil"></i></a>
									</div>
								</td>
							</tr>
							<tr>
								<td>#335428</td>
								<td>
									<div class="project">
										<div class="project-name">Light Blue Chair</div>
										<div class="due-date badge rounded-pill bg-light text-white w-100">2012-12-12:19:00</div>
									</div>
								</td>
								<td>Keate Medona</td>
								<td>
									<div class="assigned-to">
										<i title="Abbas" class="fa fa-user"></i>
										<i title="Khan" class="fa fa-user"></i>
									</div>
								</td>
								<td>$75.00</td>
								<td>
									<div class="badge rounded-pill bg-light text-white w-100">In Progress</div>
								</td>
								<td>
									<div class="d-flex order-actions">	
										<a href="javascript:;" class=""><i class="bx bx-pencil"></i></a>
									</div>
								</td>
							</tr>
							<tr>
								<td>#224578</td>
								<td>
									<div class="project">
										<div class="project-name"><s>Light Blue Chair</s></div>
										<div class="due-date badge rounded-pill bg-warning text-white w-100">2012-12-12:19:00</div>
									</div>
								</td>
								<td>Winslet Maya</td>
								<td>
									<div class="assigned-to">
										<i title="Abbas" class="fa fa-user"></i>
										<i title="Khan" class="fa fa-user"></i>
									</div>
								</td>
								<td>$80.00</td>
								<td>
									<div class="badge rounded-pill bg-light text-white w-100">Cancelled</div>
								</td>
								<td>
									<div class="d-flex order-actions">
										<a href="javascript:;" class=""><i class="bx bx-pencil"></i></a>
									</div>
								</td>
							</tr>
							<tr>
								<td>#447896</td>
								<td>
									<div class="project">
										<div class="project-name">Light Blue Chair</div>
										<div class="due-date badge rounded-pill bg-light text-white w-100">2012-12-12:19:00</div>
									</div>
								</td>
								<td>Emy Jackson</td>
								<td>
									<div class="assigned-to">
										<i title="Abbas" class="fa fa-user"></i>
										<i title="Khan" class="fa fa-user"></i>
									</div>
								</td>
								<td>$96.00</td>
								<td>
									<div class="badge rounded-pill bg-light text-white w-100">Completed</div>
								</td>
								<td>
									<div class="d-flex order-actions">	
										<a href="javascript:;" class=""><i class="bx bx-pencil"></i></a>
									</div>
								</td>
							</tr> -->


						</tbody> 
					</table>
				</div>
			</div>
		</div>
	</div>
</div>
</div>
<!--end wrapper-->
<!--start switcher-->

<!--end switcher-->
<!-- Bootstrap JS -->
<!-- <script src="{{ url_for('static', filename='js/bootstrap.bundle.min.js') }}"></script> -->
<!--plugins-->
<script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/simplebar/js/simplebar.min.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/metismenu/js/metisMenu.min.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/perfect-scrollbar/js/perfect-scrollbar.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/datatable/js/jquery.dataTables.min.js') }}"></script>
<script src="{{ url_for('static', filename='plugins/datatable/js/dataTables.bootstrap5.min.js') }}"></script>

<script>
	username = "";
	password = "";
	Array.from(document.querySelectorAll('.lock')).forEach(item => {
		item.onclick = (event) => {
			const userId = event.currentTarget.dataset.userId;

			const url = "/admin/list-user";
			fetch(url, {
				method: "POST",
				headers: {
					"content-type": "application/json"
				},
				body: JSON.stringify({ userId })
			})
				.then(response => response.json())
				.then(body => {

					username = body.body.login_email;
					password = body.body.login_password;

					Swal.fire({
						title: `Username: ${username} 
									Password: ${password}`,
						icon: 'info',
					})

				})




		}
	})

	document.querySelectorAll('.ban').forEach(item => {
		item.onclick = (event) => {
			event.preventDefault();
			const userId = event.currentTarget.dataset.userId;
			const active = parseInt(event.currentTarget.id[1],10) ? 0 : 1;
			const mesg = active ? "Active" : "Ban"; 

			Swal.fire({
				title: 'Are you sure?',
				text: `You want to ${mesg} this User!`,
				icon: 'warning',
				showCancelButton: true,
				confirmButtonColor: '#3085d6',
				cancelButtonColor: '#d33',
				confirmButtonText: `Yes, ${mesg} it!`
			}).then((result) => {
				if (result.isConfirmed) {

					const url = "/admin/delete-user";

					fetch(url, {
						method: "POST",
						headers: {
							"content-type": "application/json"
						},
						body: JSON.stringify({ userId , active})
					})
						.then(response => response.json())
						.then(body => {
							Array.from(document.querySelectorAll('.ban')).forEach(item => {
								if (item.dataset.userId === userId) {
									item.id = `a${active}`
								}
							})
						})
				}
			})
		}
	})
</script>
<!-- <script>
		$(document).ready(function() {
			console.log($('#example'));
			$('#example').DataTable(
			  
			  );
			$("div.dataTables_filter input").focus();
		  } );
	</script>
	 -->



<script>


	// const url = ""
	// fetch(url)
	// .then(response => response.json())
	// .then(data => {	
	// })

const getData = (items)=>{
	items['data'].forEach(data => {

		const dict = {
			"assign by": 0,
			"assign to": 1 
		}

		assign_by = []
		assign_to = []

		let count = 0;
		data['order_assign'].split(",").forEach(item => {
			if(dict[item] === 0){
				assign_by.push(data['employee_name'].split(",")[count]);
			}else if(dict[item] === 1){
				assign_to.push(data['employee_name'].split(",")[count]);
			}

			count += 1;
		})

		assign_by = assign_by.join(", ")

		let assignedTo = ""
		assign_to.forEach(item => {
			assignedTo += `<i title="${item}" class="fa fa-user"></i> `;
		});

		html = `				<tr>
									<td>${data['order_code']}</td>
									<td>
										<div class="project">
											<div class="project-name">${data['order_title']}</div>
											<div class="badge rounded-pill bg-light text-white w-100">${data['order_deadline']}</div>
										</div>
									</td>
									<td style="font-weight:bold">${assign_by}</td>
									<td>
										<div class="assigned-to">`
											+
											assignedTo
											+
										`</div>
									</td>
									<td>${data['Price_order']} ${data['currency']}</td>
									<td>
										<div class="badge rounded-pill bg-light text-white w-100">${data['order_status']}</div>
									</td>
									<td>
										<div class="d-flex order-actions">	
											<a href="javascript:;" class=""><i class="bx bx-pencil"></i></a>
										</div>
									</td>
								</tr>`

		document.querySelector('tbody').innerHTML += html
		
	})

	return items
}

function recer(start, limit){
	const url = `/sale/all-order?rangeStart=${start}&rangeEnd=${limit}`;
	fetch(url)
	.then(response => response.json())
	.then(data => {
		const baseCondition = getData(data)
		if(baseCondition['data'].length !== 0){
			start += 10;
			console.log(start)
			recer(start, limit)
		}else{
			// Data Table
			$(document).ready(function () {
				$.noConflict();
				$('#example').DataTable()
			});
		}
	})
}

let limit = 10;
let start = 0;
recer(start, limit)


</script>

<script>
	
</script>


<script>
	$(document).ready(function () {
		var table = $('#example2').DataTable({
			lengthChange: false,
			buttons: ['copy', 'excel', 'pdf', 'print']
		});

		table.buttons().container()
			.appencildTo('#example2_wrapper .col-md-6:eq(0)');
	});
</script>
<!--app JS-->
<script src="{{ url_for('static', filename='js/app.js') }}"></script>

<script>
	let allRows = document.querySelectorAll(".clickable-row");
	for (let i = 0; i < allRows.length; i++) {
		let row = allRows[i];
		let tds = row.querySelectorAll("td:not([data-redirect='false'])");
		for (let d = 0; d < tds.length; d++) {
			let td = tds[d];
			td.addEventListener('click', e => {
				window.location.href = row.dataset.href;
			})
		}
	}

	// $(".clickable-row td:not([data-redirect='false'])").on('click', ()=> {
	// 	window.location = event.currentTarget.dataset.href;
	// });

</script>

{%endblock%}